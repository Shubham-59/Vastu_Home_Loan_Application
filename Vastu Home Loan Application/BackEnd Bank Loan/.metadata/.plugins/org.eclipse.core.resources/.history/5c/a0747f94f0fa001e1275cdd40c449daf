package com.vashtu.app.service;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.vashtu.app.enums.Status;
import com.vashtu.app.model.EnquiryForm;
import com.vashtu.app.repository.EnquiryRepository;

@Service
public class EnquiryServiceimpl implements EnquiryService{
	@Autowired
	private EnquiryRepository enquiryRepo;

	@Override
	public EnquiryForm saveCustomerEnquiryinfo(EnquiryForm enquiry) 
	{
        if (enquiry.getStatus() == null || enquiry.getStatus().equals("")) {
            enquiry.setStatus(Status.Registered); // Set default value if status is null or empty
        }

        EnquiryForm enq = enquiryRepo.save(enquiry);
        return enq;
    }

	

	


	@Override
	public List<EnquiryForm> getAllEnquiryDetailes()
	{
		List<EnquiryForm>listEnquiry=enquiryRepo.findAll();
		
		return listEnquiry;
	}

	@Override

	public EnquiryForm getEnquiryById(int enquiryId) {
		Optional<EnquiryForm>opEnquiry=enquiryRepo.findById(enquiryId);
		if(opEnquiry.isPresent()) {
			
			EnquiryForm enquiryDetailes=opEnquiry.get();
			return enquiryDetailes;
		}
		return null;
	}
	

	@Override
	public EnquiryForm updateStatusTo_Forward(int enquiryId/* , String status */) {
		Optional<EnquiryForm>opEnquiry=enquiryRepo.findById(enquiryId);
		if(opEnquiry.isPresent()) {
			
			EnquiryForm enquiryDetailes=opEnquiry.get();
			enquiryDetailes.setStatus(Status.Forwarded);
			
			return enquiryRepo.save(enquiryDetailes);
		}
		return null;
	



		  //return null;
	}






	@Override
	public int  getAllEnquiryCount() {
		List<EnquiryForm>listEnquiry=enquiryRepo.findAll();
		int count=listEnquiry.size();
		
		System.out.println(count);
		return count;
	}






//	@Override
//	public int getAllEnquiryCountAproved() {
//		List<EnquiryForm>listEnquiry=enquiryRepo.findAll();
//		List<EnquiryForm>approvedEnquiry=new ArrayList<>();
//	int countApproved=approvedEnquiry.size();
//	
//				
//		for(EnquiryForm listApproved:listEnquiry) {
//			if(listApproved.getStatus()==Status.Approved) {
//				
//			approvedEnquiry.add(listApproved);
//			}
//		}
//		return countApproved;
//	}
	@Override
	public int getAllEnquiryCountAproved() {
	    List<EnquiryForm> listEnquiry = enquiryRepo.findAll();
	    int countApproved = 0; // Initialize count of approved enquiries

	    for (EnquiryForm enquiry : listEnquiry) {
	        if (enquiry.getStatus() == Status.Approved) {
	            countApproved++; // Increment count for each approved enquiry
	        }
	    }

	    return countApproved;
	}

	@Override
	public int getAllEnquiryCountRejected() {
		List<EnquiryForm>listEnquiry=enquiryRepo.findAll();
		int countReject=0;
		for(EnquiryForm elist:listEnquiry) {
			if(elist.getStatus()==Status.Rejected)
			countReject++;
		}
		return countReject;
	}
	@Override
	public EnquiryForm updateStatusForwardedToCM(int enquiryId) {
		Optional<EnquiryForm> opEnquiry = enquiryRepo.findById(enquiryId);
		if (opEnquiry.isPresent()) {
			EnquiryForm enquiryDetailes = opEnquiry.get();
			enquiryDetailes.setStatus(Status.ForwardedTOCM);
			return enquiryRepo.save(enquiryDetailes);
		}
		return null;
	}

	
	


}